<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Cinestelar</title>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdn.linearicons.com/free/1.0.0/icon-font.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="assets/js/excluir.js"></script>
    <script src="assets/js/jdfbdh.js" defer></script>
    <script src="assets/js/segurancaadm.js"></script>
      <script src="assets/js/seguranca.js"></script>



</head>
<body style="background-color: rgb(0, 0, 0);" class="container" >

    <header class="cabecalho " >
        <div class="divcbc d-flex">
       <a href="indexprogramador.html">
      <img class="logo cabecalho1" src="assets/img/cinestrelar.png" alt="Logo Cinestrelar">
       </a>
        <a href="#programacao" class="btn-cbc">PROGRAMAÇÃO</a>
        <a class="btn-cbc" href="snackbar.html">SNACKBAR</a>
        <a class="btn-cbc">CLUB CINESTELAR</a>
        <img src="assets/img/pino-de-localizacao.png" class="pinocbc">
         <a href="https://www.google.com/maps?q=birigui" target="_blank" class="btn-cbc2">BIRIGUI</a>
        
          

       <img id="avatar" src="assets/img/Avatar.png" class="avatarcbc">
       
        
       
        

    </header>

    <div id="divlateral" class="divconta" style="background-color: #383838; height: 100vh; width: 450px; position: fixed;" >
        <h5 class="subtit-white22 text-center" style="font-size: 30px; margin-bottom: -30px;" >Olá, Jorge!</h5>
        <div class=" text-center" >
            <a id="btnlateral" href="editarcontaadm.html" style=" display: block; width: 300px; height: 65px;" class="btnlateral btnrodape text-center">MINHA CONTA</a>
            <a id="btnlateral2" href="cadastro.html" style=" display: block; width: 300px; height: 65px; margin-top: 15px;" class="btnlateral btnrodape text-center">SAIBA MAIS SOBRE O<br>CLUB CINESTELAR</a>

         <a href="index.html" class="btnrodape text-center" 
         style="padding: 10px; background-color: red; color: white; margin-top: 55px; display: block; width: 70%; margin-left: auto; margin-right: auto;">
        VOLTAR PARA HOME
        </a>
        
        
            <button id="btnlogout" class="Btn">
                <div class="sign">
                    <svg viewBox="0 0 512 512">
                    
                        <path d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"></path>
                
                    </svg>
                
                </div>
              
                <div class="text">Sair</div>
            
            </button>

            <a id="fechar" class="btnrodape text-center" style="padding: 10px; background-color: red; color: white; margin: 400px auto; display: block; width: 70%;" >FECHAR</a>
        </div>
    </div>

    <section>
        
           <!-- Container que alinha os botões lado a lado -->
<div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 60px;">

  <!-- Botão Cadastrar Filme -->
  <a href="cadastroFilme.html" 
     style="display: flex; justify-content: center; align-items: center; width: 250px; height: 65px; background-color: white; color: black; text-decoration: none; font-weight: bold; border-radius: 8px; margin-top: 154px;" 
     class="btnrodape text-center">
     CADASTRAR FILME
  </a>

  <!-- Botão Criar Sala -->
  <a href="criarsala.html" 
     style="display: flex; justify-content: center; align-items: center; width: 250px; height: 65px; background-color: white; color: black; text-decoration: none; font-weight: bold; border-radius: 8px; margin-top: 154px;" 
     class="btnrodape text-center">
     CRIAR SALA
  </a>

  <!-- Botão Criar Sessão -->
  <a href="addsessao.html?idfilme=${filme.id_cadastrof}" 
     style="display: flex; justify-content: center; align-items: center; width: 250px; height: 65px; background-color: white; color: black; text-decoration: none; font-weight: bold; border-radius: 8px; margin-top: 154px;" 
     class="btnrodape text-center">
     CRIAR SESSÃO
  </a>

</div>
 <h3 id="programacao" class="subtit-white22">PROGRAMAÇÃO</h3>
        <div class="container">
            <div class="row" id="filmesexibe" ></div>
                    

            </div>
        </div>

<!-- IMPORTA SWEETALERT2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<h3 class="subtit-white22" style="margin-top: 100px;">
    CADASTRAR PROMOÇÕES
</h3>
<div class="container">
    <div class="row">
        <div class="col-md-4"></div>
        <div class="col-md-4">
            <a href="addpromo.html" style="display: block; width: 100%; height: 65px; margin-bottom: 60px;" class="btnrodape text-center">CADASTRAR PROMOÇÃO</a>
        </div>
        <div class="col-md-4"></div>
    </div>
</div>

<h3 class="subtit-white22" style="margin-top: 18px; margin-bottom: 30px">
    EDITAR PROMOÇÕES
</h3>

<div class="container">
    <div class="row" id="promoexibe" style="margin-bottom: 116px;">
        <!-- Promoções serão carregadas aqui -->
    </div>
</div>


<script>
// Pegando o token do localStorage
const TOKEN = localStorage.getItem("token");

async function carregarPromocoes() {
    try {
        const resposta = await fetch("http://192.168.1.130:5000/promocao");
        const dados = await resposta.json();

        const promocoesContainer = document.getElementById("promoexibe");
        promocoesContainer.innerHTML = "";

        dados.promocao.forEach(promo => {
            const promoDiv = document.createElement("div");

            promoDiv.classList.add("col-12", "col-md-4", "mb-4", "promo-item");
            promoDiv.id = `promo-${promo.id_promo}`;

        promoDiv.innerHTML = `
<div class="promo-card border p-3 rounded bg-light shadow-sm">
    <div class="promo-content text-center">
        <img class="promo-img img-fluid mb-3" src="http://192.168.1.130:5000/${promo.capapromo}" alt="Promoção">
        <h5 class="promo-title">${promo.titulo}</h5>
        <p class="promo-text">${promo.descricaopromo}</p>
        <div class="d-flex justify-content-center gap-2 mt-3">
            <a href="editpromo.html?id=${promo.id_promo}" 
               class="btn text-white" 
               style="background-color: red; font-size: 14px; padding: 6px 12px; border-radius: 6px;">
               Editar
            </a>
            <button class="btn text-white delete-btn" 
                    data-id="${promo.id_promo}" 
                    style="background-color: red; font-size: 14px; padding: 6px 12px; border-radius: 6px;">
                Excluir
            </button>
        </div>
    </div>

    



                    </div>
                </div>
            `;


            

            promocoesContainer.appendChild(promoDiv);
        });

        // Adiciona evento para cada botão de excluir
        document.querySelectorAll('.delete-btn').forEach(button => {
            button.addEventListener('click', async function () {
                const id = this.getAttribute('data-id');

                const confirmar = await Swal.fire({
                    title: 'Tem certeza?',
                    text: "Você deseja excluir esta promoção?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Sim, excluir!',
                    cancelButtonText: 'Cancelar'
                });

                if (confirmar.isConfirmed) {
                    try {
                        const resposta = await fetch(`http://192.168.1.130:5000/promocao/delete/${id}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${TOKEN}`
                            }
                        });

                        const json = await resposta.json();

                        if (resposta.status === 401) {
                            Swal.fire({
                                title: 'Sessão expirada',
                                text: json.mensagem || 'Seu token é inválido ou expirou. Faça login novamente.',
                                icon: 'warning',
                                confirmButtonText: 'OK'
                            }).then(() => {
                                window.location.href = 'login.html';
                            });
                            return;
                        }

                        if (resposta.ok) {
                            document.getElementById(`promo-${id}`).remove();
                            Swal.fire({
                                title: 'Excluído!',
                                text: json.mensagem || 'Promoção excluída com sucesso.',
                                icon: 'success',
                                timer: 2000,
                                showConfirmButton: false
                            });
                        } else {
                            Swal.fire({
                                title: 'Erro',
                                text: json.mensagem || 'Erro ao excluir a promoção.',
                                icon: 'error'
                            });
                        }
                    } catch (erro) {
                        console.error("Erro na exclusão:", erro);
                        Swal.fire({
                            title: 'Erro de conexão',
                            text: 'Não foi possível se conectar ao servidor.',
                            icon: 'error'
                        });
                    }
                }
            });
        });

    } catch (error) {
        console.error("Erro ao carregar promoções:", error);
        Swal.fire({
            title: 'Erro',
            text: 'Erro ao carregar promoções.',
            icon: 'error'
        });
    }
}


// Carrega promoções ao abrir a página
carregarPromocoes();
</script>


        <script>
// Função assíncrona para carregar os filmes do servidor
async function carregarFilmes() {
    try {
        // Faz uma requisição para a API que retorna a lista de filmes
        const resposta = await fetch("http://192.168.1.130:5000/filme");
        



        // Converte a resposta para JSON
        const dados = await resposta.json();

        // Obtém o contêiner onde os filmes serão exibidos
        const filmesContainer = document.getElementById("filmesexibe");

        // Percorre a lista de filmes retornada pela API
        dados.cadastro.forEach(filme => {
            // Verifica se o filme já foi adicionado à página para evitar duplicatas
            if (!document.getElementById(`filme-${filme.id_cadastrof}`)) {
                // Cria um novo elemento <div> para exibir as informações do filme
                const filmeDiv = document.createElement("div");

                // Adiciona classes CSS para estilização
                filmeDiv.classList.add("col-md-2", "img-programacao", "text-center");

                // Define um ID único para o filme
                filmeDiv.id = `filme-${filme.id_cadastrof}`;

                // Define o conteúdo HTML do elemento, incluindo imagem e botões de ação
                filmeDiv.innerHTML = `

      
    

            
       <!-- CONTAINER DOS FILMES -->
     <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 32px; padding: 20px;">


    <!-- BLOCO DE UM FILME -->
     <div style="width: 192px; text-align: center;">
    

        <!-- Imagem do filme -->

        <a href="pagefilme.html?id=${filme.id_cadastrof}">
            <img class="img-filme" src="http://192.168.1.130:5000/${filme.imagem}" 
                 alt="${filme.titulo}" 
                 style="width: 170px; height: 264px; border-radius: 8px;">
        </a>

        <!-- Botão EDITAR -->
        <a href="editfilme.html?id=${filme.id_cadastrof}&titulo=${filme.titulo}&sinopse=${filme.sinopse}&genero=${filme.genero}&duracao=${filme.duracao}&diretor=${filme.diretor}&elenco=${filme.elenco}&classificacao=${filme.classificacao}" 
           style="display: block; width: 170px; height: 60px; margin: 18px auto 10px; padding: 50px padding-top: 70px" 
           class="btnrodape text-center">
           EDITAR FILME
        </a>

        

        <!-- Botão EXCLUIR -->
        <button class="btn-danger btnexcluir" id="btnexcluir"
                style="display: block; width: 70%; height: 50px; margin: 0 auto;
                       background-color: red; color: white;
                       font-family: Poppins; font-weight: 600; border-radius: 10px; padding: 20px">
            EXCLUIR
        </button>

    </div>
    <!-- FIM DO BLOCO DO FILME -->

    <!-- Repita esse bloco para cada filme -->

</div>



                `;

                // Adiciona o novo elemento ao contêiner de filmes
                filmesContainer.appendChild(filmeDiv);
            }
        });
    } catch (erro) {
        // Exibe um erro no console caso a requisição falhe
        console.error("Erro ao carregar os filmes:", erro);
    }
}

// Chama a função para carregar os filmes ao carregar a página
carregarFilmes();
        
        </script>


    <script>
$(document).ready(function () {
    $(".btnexcluir").on("click", function () {
        let itemId = $(this).data("id"); // Pega o ID do item

        $.ajax({
            url: `http://192.168.1.130:500/deletar/${itemId}`, // URL para a exclusão do item
            type: "DELETE",
            success: function (response) {
                console.log(response); // Verifica a resposta do servidor

                if (response.message) {
                    // Se a exclusão for bem-sucedida, remove o item do HTML
                    $(`li[data-id="${itemId}"]`).remove();

                    // Exibe um alerta de sucesso
                    Swal.fire({
                        title: "Filme excluído com sucesso!",
                        icon: "success",
                        draggable: true
                    }).then(() => {
                        // Redireciona ou faz outra ação conforme necessário
                        // window.location.reload(); // Exemplo de recarregar a página
                    });
                }
            },
            error: function (resposta) {
                // Quando há erro na requisição
                Swal.fire({
                    icon: "error",
                    title: "Erro ao excluir",
                    text: resposta.responseJSON?.error || "Ocorreu um erro, tente novamente mais tarde.",
                });
            }
        });
    });
});


    </script>
        
        
       
    </head>
    <body>
    
       
        <h3 class="subtit-white22" style="margin-top: 180px;" >
            FILMES MAIS ASSISTIDOS
        </h3>

        <div class="container">
            <div class="row"  >
                <div class="col-md-2 img-programacao text-center">
                    <a href="" ><img style="width: 100%;" class="img-programacao" src="assets/img/images (2).jfif"></a>
                </div>

                <div class="col-md-2 img-programacao">
                    <a href=""><img style="width: 100%;" class="img-programacao" src="assets/img/images (2).jfif"></a>

                </div>

                <div class="col-md-2 img-programacao">
                    <a href=""><img style="width: 100%;" class="img-programacao" src="assets/img/images (2).jfif"></a>

                </div>

                <div class="col-md-2 img-programacao">
                    <a href=""><img style="width: 100%;" class="img-programacao" src="assets/img/images (2).jfif"></a>

                </div>
                
                <div class="col-md-2 img-programacao">
                    <a href=""><img style="width: 100%;" class="img-programacao" src="assets/img/images (2).jfif"></a>

                </div>

                <div class="col-md-2 img-programacao">
                    <a href=""><img style="width: 100%;" class="img-programacao" src="assets/img/images (2).jfif"></a>

                </div>
            </div>
        </div>


        



        <h3 class="subtit-white22">
            RELATÓRIO
        </h3>

        <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-4" >
                <a href="http://192.168.1.130:5000/usuario/relatorio" style=" display: block; width: 100%; height: 65px; margin-bottom: 60px;" class="btnrodape text-center">RELATÓRIO</a>
            </div>
            <div class="col-md-4"></div>
        </div>

        
        <h3 class="subtit-white22">
            LISTA USUÁRIOS
        </h3>

        <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-4" >
                <a href="listauser.html" style=" display: block; width: 100%; height: 65px; margin-bottom: 60px;" class="btnrodape text-center">ABRIR LISTA</a>
            </div>
            <div class="col-md-4"></div>
        </div>

    </section>
    

</body>
</html>